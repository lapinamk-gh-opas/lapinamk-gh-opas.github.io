<section class="how-to-survive-mc">
  <header>
    <h1>Merge-konfliktin ratkaiseminen käytännössä</h1>

    <p>
      Tässä ohjeessa opit, miten <strong>merge-konflikti syntyy</strong> ja
      <strong>kuinka se ratkaistaan käytännössä.</strong>
    </p>

    <p>
      Harjoituksessa simuloidaan konfliktia ja sen korjaamista hyödyntäen VS Codea, terminaalia sekä
      GitHubia.
    </p>

    <div class="note-box">
      <strong>Huom!</strong> Merge-konflikteja voidaan ratkaista myös monilla muilla eri tavoilla ja
      työkaluilla, esimerkiksi GitHubin editorilla, VS Coden merge-näkymällä tai
      komentorivipohjaisilla ratkaisuilla.
    </div>
  </header>
  <main>
    <h2>Merge-konfliktien ratkaiseminen</h2>

    <p>
      Aluksi luodaan paikallinen kansio ja kloonataan siihen etärepositorio
      <strong>git-opas</strong>. Sen jälkeen muokataan samaa tiedostoa GitHubin päähaarassa sekä
      paikallisesti omassa haarassa, ja lopuksi yhdistetään muutokset, jolloin syntyy
      merge-konflikti.
    </p>

    <ol>
      <li>
        <h6>Luo uusi kansio testausta varten</h6>
        <ul>
          <li>Klikkaa <strong>Open Folder</strong></li>
        </ul>
        <figure>
          <img
            class="wide-image"
            src="../../assets/images/teamwork/pull-request/clone-1.webp"
            alt="Aloitusnäkymä VS Codessa" />
          <figcaption>Aloitusnäkymä VS Codessa</figcaption>
        </figure>
        <ul>
          <li
            >Navigoi haluamaasi kansioon ja klikkaa
            <strong>Uusi kansio</strong>
          </li>
          <li>Anna kansiolle nimi ja klikkaa <strong>Valitse kansio</strong> </li>
        </ul>
        <figure>
          <img
            class="wide-image"
            src="../../assets/images/teamwork/merge-conflicts/merge-konflikti-1.webp"
            alt="Uuden kansion luominen ja valitseminen" />
          <figcaption>Uuden kansion luominen ja valitseminen</figcaption>
        </figure>

        <!-- Accordion element 1. starts -->
        <div
          class="accordion"
          data-include="../../accordion-element/accordion.html"
          data-title="Do you trust the authors of the files in this folder? -varoitus">
          <div
            class="contentToAccordion reused-accordion"
            data-include="/reused-accordion-content/trust-the-authors.html">
            <!-- Accordion content starts from /reused-accordion-content/trust-the-authors.html-->
          </div>
        </div>
        <!-- Accordion element 1. ends -->
      </li>
      <li>
        <h6>Kloonaa (<em>clone</em>) etärepositorio ja luo uusi haara</h6>
        <ul>
          <li>Avaa Git Bash VS Coden terminaaliin</li>

          <li>
            Kloonaa repositorio <strong>git-opas</strong> pilvestä omalle koneelle komennolla
            <code>git clone https://github.com/repositorion/url-osoite.git</code>
          </li>

          <li>
            Siirry repositorion sisältävään kansioon komennolla
            <code>cd kansion-nimi</code>
          </li>

          <li>
            Luo uusi git-haara ja siirry uuteen haaraan komennolla
            <code>git checkout -b haaran-nimi</code>
          </li>
        </ul>
        <figure>
          <img
            class="wide-image"
            src="../../assets/images/teamwork/merge-conflicts/merge-konflikti-2.webp"
            alt="VS Coden terminaali ja komennot" />
          <figcaption>Repositorion kloonaus ja uuden haaran luominen komennoilla </figcaption>
        </figure>

        <!--Accordion 2. starts-->
        <div
          class="accordion"
          data-include="../../accordion-element/accordion.html"
          data-title="Git Bashin avaaminen VS Codessa">
          <div
            class="contentToAccordion reused-accordion"
            data-include="/reused-accordion-content/git-bash-on-vscode.html">
            <!-- Accordion content starts from /reused-accordion-content/git-bash-on-vscode.html-->
          </div>
        </div>
        <!-- Accordion 2. ends-->
      </li>
      <li>
        <h6>Tee muutokset tiedostoon</h6>
        <ul>
          <li>
            Tee haluamasi <strong>muutokset</strong> tiedostoon testi-tiedosto.md (tai johonkin
            muuhun tiedostoon kunhan teet muutokset myöhemmin samaan tiedostoon GitHubissa)
          </li>
          <li>Tallenna muutokset <strong>CTRL</strong> + <strong>S</strong> pikanäppäimillä</li>
        </ul>
        <figure>
          <img
            class="wide-image"
            src="../../assets/images/teamwork/merge-conflicts/merge-konflikti-3.webp"
            alt="Muutosten tekeminen testi-tiedosto.md tiedostoon" />
          <figcaption>Valittu tiedosto ja muutokset tiedostoon</figcaption>
        </figure>
      </li>
      <li>
        <h6>Siirry selaimella GitHubiin ja valitse käyttämäsi repositorio</h6>
        <ul>
          <li>Varmista, että olet <strong>päähaarassa</strong></li>
          <li>
            Avaa sama tiedosto, johon teit muutokset paikallisesti klikkaamalla tiedoston nimeä
          </li>
        </ul>
        <figure>
          <img
            class="wide-image"
            src="../../assets/images/teamwork/merge-conflicts/merge-konflikti-4.webp"
            alt="Tiedostot GitHib repositoriossa" />
          <figcaption>Valitun git-haaran varmistaminen ja tiedoston valitseminen</figcaption>
        </figure>
      </li>
      <li>
        <h6>Tee muutokset tiedostoon GitHubissa</h6>
        <ul>
          <li>Klikkaa <strong>kynä-ikonia</strong> avataksesi muokkausikkunan </li>
        </ul>
        <figure>
          <img
            class="wide-image"
            src="../../assets/images/teamwork/merge-conflicts/merge-konflikti-5.webp"
            alt="Tiedosto ja muokkausikkunan avaaminen" />
          <figcaption>Tiedosto ja muokkausikkunan avaaminen</figcaption>
        </figure>
        <ul>
          <li>Tee haluamasi <strong>muutos</strong> tiedostoon</li>
          <li>Ja klikkaa <strong>Commit changes...</strong>-nappia</li>
        </ul>
        <figure>
          <img
            class="wide-image"
            src="../../assets/images/teamwork/merge-conflicts/merge-konflikti-6.webp"
            alt="Muokkausikkuna ja muutokset" />
          <figcaption>Muutosten tekeminen tiedostoon ja Commit changes... -nappi</figcaption>
        </figure>
        <ul>
          <li>Anna commit-viesti <strong>Commit message</strong> -tekstikenttään </li>
          <li
            >Ja klikkaa <strong>Commit changes</strong> -nappia tallentaaksesi muutokset
            päähaaraan</li
          >
        </ul>
        <figure>
          <img
            class="wide-image"
            src="../../assets/images/teamwork/merge-conflicts/merge-konflikti-7.webp"
            alt="Näkymä muutosten tallentamiseen (commit)" />
          <figcaption>Commit-viestin lisääminen ja Commit changes -nappi </figcaption>
        </figure>
      </li>
      <li>
        <h6>Commitoi paikalliset muutokset ja </h6>
        <ul>
          <li>Siirry takaisin VS Codeen ja avaa terminaali</li>
          <li>
            Lisää paikalliset muutokset staging-alueelle komennolla
            <code>git add .</code>
          </li>
          <li>
            Commitoi muutokset paikalliseen repositorioon komennolla
            <code>git commit -m "commit-viesti"</code>
          </li>
        </ul>
      </li>
      <li>
        <h6>Tuo etärepositoriosta tehdyt muutokset</h6>
        <ul>
          <li>
            Tuo etärepositoriossa tehdyt muutokset paikalliseen repositorioon komennolla
            <code>git pull origin main</code>
          </li>
          <li> Tässä vaiheessa pitäisi syntyä <strong>merge-konflikti</strong></li>
          <li>
            Git ilmoittaa terminaalissa konfliktista, eikä tiedostoa voida yhdistää automaattisesti
          </li>
        </ul>

        <figure>
          <img
            class="wide-image"
            src="../../assets/images/teamwork/merge-conflicts/merge-konflikti-8.webp"
            alt="Paikallisten muutosten commitointi ja muutosten tuonti
            etärepositoriosta" />
          <figcaption
            >Paikallisten muutosten commitointi ja muutosten tuonti etärepositoriosta</figcaption
          >
        </figure>
      </li>
      <li>
        <h6>Ratkaise merge-konflikti</h6>
        <ul>
          <li>
            Avaa konfliktit sisältävä tiedosto VS Codessa klikkaamalla
            <strong>tiedoston nimeä</strong> (tiedosto on merkitty punaisella värillä ja
            huutomerkillä)
          </li>
          <li>
            Konfliktit on merkitty erikoismerkeillä ja väreillä: vihreä näyttää paikalliset
            muutokset ja sininen etärepositoriosta tulevat muutokset
          </li>
          <li>
            Ratkaise konflikti klikkaamalla <em>Accept</em> <strong>Current</strong>,
            <strong>Incoming</strong> tai <strong>Both</strong> <em>Changes</em> -nappia riippuen
            siitä mitkä muutokset haluat säilyttää
          </li>
          <li>Tallenna tiedosto <strong>CTRL</strong> + <strong>S</strong> pikanäppäimillä</li>
        </ul>
        <figure>
          <img
            class="wide-image"
            src="../../assets/images/teamwork/merge-conflicts/merge-konflikti-9.webp"
            alt="Merge-konfliktin ratkaiseminen VS Codessa" />
          <figcaption>Merge-konfliktin ratkaiseminen VS Codessa</figcaption>
        </figure>
        <ul>
          <li>
            Lisää ratkaistut tiedostot staging-alueelle komennolla
            <code>git add .</code>
          </li>
          <li>
            Viimeistele haarojen yhdistäminen (merge) commitoimalla ratkaistu konflikti komennolla
            <code>git commit -m "Sopiva commit-viesti"</code>
          </li>
        </ul>
        <figure>
          <img
            class="wide-image"
            src="../../assets/images/teamwork/merge-conflicts/merge-konflikti-10.webp"
            alt="Mergen viimeistely konfliktin ratkaisun jälkeen" />
          <figcaption>Mergen viimeistely konfliktin ratkaisun jälkeen </figcaption>
        </figure>
      </li>
      <li>
        <h6>Vie muutokset etärepositorioon</h6>
        <ul>
          <li>
            Vie paikalliset muutokset etärepositorioon komennolla
            <code>git push -u origin haaran-nimi</code>
          </li>
        </ul>
        <figure>
          <img
            class="wide-image"
            src="../../assets/images/teamwork/merge-conflicts/merge-konflikti-11.webp"
            alt="Haaran muutosten vieminen etärepositorioon" />
          <figcaption>Haaran muutosten vieminen etärepositorioon </figcaption>
        </figure>
      </li>
      <li>
        <h6>Viimeistele yhdistämällä muutokset päähaaraan</h6>
        <ol>
          <li>
            Tee pull request noudattaen
            <a href="/teamwork/pullrequests.html#how-to-pr">Pull Request -ohjetta</a>
            kohdasta 5. eteenpäin
          </li>
          <li
            >Tai yhdistä haarat komennoilla ohjeen
            <a href="/teamwork/branches.html#how-to-branches"
              >Feature-haaran yhdistäminen main-haaraan komentokehottella</a
            >
            mukaisesti
          </li>
        </ol>
      </li>
    </ol>
  </main>
</section>
