<section class="how-to-survive-mc">
  <header>
    <h1>Merge-konfliktien ratkaiseminen käytännössä</h1>
    <p>
      Merge-konflikti syntyy tilanteessa, jossa kahdessa eri haarassa (branchissa) on muokattu samaa
      tiedoston kohtaa eri tavoin, eikä Git pysty automaattisesti yhdistämään muutoksia. Konfliktit
      ovat luonnollinen osa tiimityöskentelyä ja haarojen yhdistämistä, eivätkä yleensä merkki
      virheestä.
    </p>

    <p>
      Tämän ohjeen tarkoituksena on kuvata, mitä merge-konfliktit ovat, miksi ne syntyvät ja kuinka
      ne ratkaistaan käytännössä. Ohje auttaa tunnistamaan konfliktit, ymmärtämään niiden rakenteen
      Gitin näkökulmasta sekä valitsemaan sopivan ratkaisun.
    </p>

    <p>
      Ohjeessa simuloidaan virhettä ja sen korjaamista VS Coden ja sen terminaalin sekä GitHubin
      avulla. Tämä ohje keskittyy erityisesti tilanteisiin, joissa kaksi kehittäjää työskentelee
      samassa tiedostossa ja tekee päällekkäisiä muutoksia.
    </p>
  </header>
  <main>
    <h2>Merge-konfliktien ratkaiseminen</h2>

    <p>
      Luodaan taas aluksi paikallisesti uusi kansio tätä osiota varten ja kloonataan etärepositorio
      sinne uudeksi paikalliseksi repositorioksi. Tehdään muutoksia samaan tiedostoon selaimella
      GitHubin päähaarassa sekä paikallisesti omassa haarassa ja yhdistetään ne, jotta saadaan
      aikaan merge-konflikti.
    </p>
    <div class="note-box">
      <strong>Huomio:</strong> Mergekonfliktit voidaan ratkaista useilla eri tavoilla ja eri
      työkaluilla. Tässä oppaassa näytetään vain yksi yksinkertainen esimerkki, jotta konfliktien
      ratkaisemisen perusmekanismi tulee selväksi. Käytännössä konfliktit voivat olla
      monimutkaisempia ja niiden ratkaisuun voi käyttää myös graafisia työkaluja, kuten GitHubin
      omaa editoria, VS Coden merge-näkymää tai komentoriville tarjolla olevia työkaluja.
    </div>
    <ol>
      <li>
        <h6>Luo uusi kansio testausta varten</h6>
        <ul>
          <li>Klikkaa <strong>Open Folder</strong></li>
        </ul>
        <figure>
          <img
            class="wide-image"
            src="../../assets/images/teamwork/pull-request/clone-1.webp"
            alt="Aloitus näkymä VS Codessa." />
          <figcaption>Aloitus näkymä VS Codessa.</figcaption>
        </figure>
        <ul>
          <li>Navigoi haluamaasi kansioon ja klikkaa <strong>Uusi kansio</strong></li>
          <li>Anna kansiolle nimi ja klikkaa <strong>Valitse kansio</strong></li>
        </ul>
        <figure>
          <img
            class="wide-image"
            src="../../assets/images/teamwork/merge-conflicts/merge-konflikti-1.webp"
            alt="Uuden kansion luominen ja valitseminen" />
          <figcaption>Uuden kansion luominen ja valitseminen</figcaption>
        </figure>

        <!-- Accordion element starts -->
        <div
          class="accordion"
          data-include="../../accordion-element/accordion.html"
          data-title="Do you trust the authors of the files in this folder? -varoitus">
          <!-- Reused accordion content starts -->
          <div
            class="contentToAccordion reused-accordion"
            data-include="/reused-accordion-content/trust-the-authors.html">
            <!-- Accordion content starts from /reused-accordion-content/trust-the-authors.html-->
          </div>
          <!-- Reused accordion content ends -->
        </div>
        <!-- Accordion element ends -->
      </li>
      <li>
        <h6>Kloonaa (<em>Clone</em>) etärepositorio ja luo uusi haara</h6>
        <ul>
          <li>Avaa Git Bash VS Coden terminaaliin.</li>

          <li>
            Kloonaa repositorio palvelimelta omalle koneelle komennolla
            <code>git clone https://github.com/repositorion/url-osoite.git</code>
            ja paina <strong>Enter</strong>.
          </li>

          <li>
            Siirry repositorion sisältävään kansioon komennolla
            <code>cd kansion-nimi</code>
            ja paina <strong>Enter</strong>.
          </li>

          <li>
            Luo uusi git-haara ja siirry uuteen haaraan komennolla
            <code>git checkout -b haaran-nimi</code> ja paina <strong>Enter</strong>.
          </li>
        </ul>
        <figure>
          <img
            class="wide-image"
            src="../../assets/images/teamwork/merge-conflicts/merge-konflikti-2.webp"
            alt="VS Coden terminaali ja komennot." />
          <figcaption>Kuvassa merkattuna terminaalissa käytetyt komennot.</figcaption>
        </figure>
        <!--Accordion starts-->
        <div
          class="accordion"
          data-include="../../accordion-element/accordion.html"
          data-title="Huomio Git Bashin käytöstä VS Codella">
          <!-- Reused accordion content starts -->
          <div
            class="contentToAccordion reused-accordion"
            data-include="/reused-accordion-content/git-bash-on-vscode.html">
            <!-- Accordion content starts from /reused-accordion-content/git-bash-on-vscode.html-->
          </div>
          <!-- Reused accordion content ends -->
        </div>
        <!-- Accordion ends-->
      </li>
      <li>
        <h6>Muutoksen tekeminen tiedostoon paikallisesti.</h6>
        <ul>
          <li>
            Tee haluamasi <strong>muutokset</strong> tiedostoon testi-tiedosto.md (tai johonkin
            muuhun tiedostoon kunhan teet muutokset myöhemmin samaan tiedostoon GitHubissa).
          </li>
          <li>Tallenna muutokset <strong>CTRL</strong> + <strong>S</strong> pikanäppäimillä.</li>
        </ul>
        <figure>
          <img
            class="wide-image"
            src="../../assets/images/teamwork/merge-conflicts/merge-konflikti-3.webp"
            alt="Muutoksien tekeminen testi-tiedosto.md tiedostoon." />
          <figcaption
            >Valittu tiedosto ja muutoksien tekeminen tiedostoon merkattu punaisella.</figcaption
          >
        </figure>
      </li>
      <li>
        <h6>Mene selaimella GitHubiin ja valitse käyttämäsi repositorio.</h6>
        <ul>
          <li>Varmista, että olet <strong>päähaarassa</strong>.</li>
          <li>
            Avaa sama tiedosto, johon teit muutokset paikallisesti klikkaamalla tiedoston nimeä.
          </li>
        </ul>
        <figure>
          <img
            class="wide-image"
            src="../../assets/images/teamwork/merge-conflicts/merge-konflikti-4.webp"
            alt="Tiedostot GitHib repositoriossa" />
          <figcaption>Valitun git-haaran varmistaminen ja tiedoston valitseminen.</figcaption>
        </figure>
      </li>
      <li>
        <h6>Muutoksen tekeminen tiedostoon GitHubissa.</h6>
        <ul>
          <li>Klikkaa <strong>kynä-ikonia</strong> avataksesi muokkausikkunan.</li>
        </ul>
        <figure>
          <img
            class="wide-image"
            src="../../assets/images/teamwork/merge-conflicts/merge-konflikti-5.webp"
            alt="Tiedosto ja muokkausikkunan avaaminen" />
          <figcaption>Kynä-ikonista saa avattua muokkaus ikkunan.</figcaption>
        </figure>
        <ul>
          <li>Tee haluamasi <strong>muutos</strong> tiedostoon.</li>
          <li>Ja klikkaa <strong>Commit changes...</strong>-nappia.</li>
        </ul>
        <figure>
          <img
            class="wide-image"
            src="../../assets/images/teamwork/merge-conflicts/merge-konflikti-6.webp"
            alt="Muokkausikkuna ja muutokset" />
          <figcaption>Muutoksien tekeminen tiedostoon ja Commit changes... -nappi.</figcaption>
        </figure>
        <ul>
          <li>Anna commit-viesti <strong>Commit message</strong> tekstikenttään.</li>
          <li
            >Ja klikkaa <strong>Commit changes</strong> -nappia tallentaaksesi muutokset
            päähaaraan.</li
          >
        </ul>
        <figure>
          <img
            class="wide-image"
            src="../../assets/images/teamwork/merge-conflicts/merge-konflikti-7.webp"
            alt="Näkymä muutoksien tallentamiseen (commit)" />
          <figcaption>Commit-viestin lisääminen ja Commit changes -nappi.</figcaption>
        </figure>
      </li>
      <li>
        <h6>Paikallisten muutoksien commitointi ja muutoksien tuominen etärepositoriosta.</h6>
        <ul>
          <li>Siirry takaisin VS Codeen ja sen terminaaliin.</li>
          <li>
            Lisää paikalliset muutokset staging-alueelle komennolla
            <code>git add .</code> ja paina <strong>Enter</strong>.
          </li>
          <li>
            Commitoi muutokset paikalliseen repositorioon komennolla
            <code>git commit -m "commit-viesti"</code> ja paina <strong>Enter</strong>.
          </li>
          <li>
            Tuo etärepositoriossa tehdyt muutokset paikalliseen repositorioon komennolla
            <code>git pull origin päähaara</code> ja paina <strong>Enter</strong>.
          </li>
          <li>
            Tässä vaiheessa pitäisi syntyä merge-konflikti. Git ilmoittaa terminaalissa
            <strong>konfliktista ja tiedostoa ei voida yhdistää automaattisesti.</strong>
          </li>
        </ul>

        <figure>
          <img
            class="wide-image"
            src="../../assets/images/teamwork/merge-conflicts/merge-konflikti-8.webp"
            alt="Paikallisten muutoksien commitointi ja etärepositorion muutoksien tuominen ja yhdistäminen." />
          <figcaption
            >Paikallisten muutoksien commitointi komennot ja muutoksien tuonti
            etärepositoriosta.</figcaption
          >
        </figure>
      </li>
      <li>
        <h6>Merge-konfliktin ratkaiseminen.</h6>
        <ul>
          <li>
            Avaa konfliktit sisältävä tiedosto VS Codessa klikkaamalla
            <strong>tiedoston nimeä</strong>. Tiedosto on merkitty punaisella värillä ja
            huutomerkillä.
          </li>
          <li>
            Konfliktit on merkitty erikoismerkeillä, jotka erottavat eri haarojen muutokset. Vihreä
            osa tarkoittaa paikallisia muutoksia, kun taas sininen osa näyttää etärepositoriosta
            tulevia muutoksia.
          </li>
          <li>
            Ratkaise konflikti klikkaamalla <strong>Current</strong>, <strong>Incoming</strong> tai
            <strong>Both</strong>-nappia riippuen siitä mitkä muutokset haluat säilyttää.
          </li>
          <li>Tallenna tiedosto <strong>CTRL</strong> + <strong>S</strong> pikanäppäimillä.</li>
        </ul>
        <figure>
          <img
            class="wide-image"
            src="../../assets/images/teamwork/merge-conflicts/merge-konflikti-9.webp"
            alt="Merge-konfliktin ratkaiseminen VS Codessa." />
          <figcaption>Merge-konfliktin ratkaiseminen VS Codessa.</figcaption>
        </figure>
        <ul>
          <li>
            Lisää ratkaistut tiedostot staging-alueelle komennolla
            <code>git add .</code> ja paina <strong>Enter</strong>.
          </li>
          <li>
            Viimeistele haarojen yhdistäminen (merge) commitoimalla ratkaistu konflikti komennolla
            <code>git commit -m "Sopiva commit-viesti"</code> ja paina <strong>Enter</strong>.
          </li>
        </ul>
        <figure>
          <img
            class="wide-image"
            src="../../assets/images/teamwork/merge-conflicts/merge-konflikti-10.webp"
            alt="yhdistämisen viimeistely ratkaisun jälkeen." />
          <figcaption
            >Komennot haarojen yhdistämisen (merge) viimeistelyyn konfliktin ratkaisun
            jälkeen.</figcaption
          >
        </figure>
      </li>
      <li>
        <h6>Vie muutokset etärepositorioon.</h6>
        <ul>
          <li>
            Vie paikalliset muutokset etärepositorioon komennolla
            <code>git push -u origin haaran-nimi</code> ja paina <strong>Enter</strong>.
          </li>
        </ul>
        <figure>
          <img
            class="wide-image"
            src="../../assets/images/teamwork/merge-conflicts/merge-konflikti-11.webp"
            alt="Haaran muutoksien vieminen etärepositorioon." />
          <figcaption>Komento haaran muutoksien viemiselle etärepositorioon.</figcaption>
        </figure>
      </li>
      <li>
        <h6>Viimeistele yhdistämällä muutokset päähaaraan</h6>
        <ol>
          <li>
            Pull Requestilla noudattaen
            <a href="/teamwork/pullrequests.html#how-to-pr">Pull Request -ohjetta</a>
            kohdasta 5. eteenpäin.
          </li>
          <li
            >Tai yhdistämällä ohjeen:
            <a href="/teamwork/branches.html#how-to-branches"
              >Feature-haaran yhdistäminen main-haaraan komentokehottella</a
            >
            mukaisesti.
          </li>
        </ol>
      </li>
    </ol>
  </main>
</section>
