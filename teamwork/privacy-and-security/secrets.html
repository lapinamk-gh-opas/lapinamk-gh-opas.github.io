<section class="secrets">
  <header>
    <h1>Salaisuuksien ja tiedostojen suojaaminen</h1>

    <p>
      Kuten edelliselläkin sivulla mainittiin, GitHub-repositorioon <strong>ei saa lisätä
      arkaluontoisia tietoja</strong>. Tällaiset tiedot voivat joutua vääriin
      käsiin ja vaarantaa projektin turvallisuuden. Tästä syystä on tärkeää
      ymmärtää, miten salaisuuksia ja
      muita arkaluontoisia tietoja käsitellään versionhallinnan näkökulmasta.
    </p>

    <p>Tällä sivulla opit, miten estät arkaluontoisten tietojen päätymisen
      versionhallintaan ja miten GitHub voi auttaa suojaamaan niitä
      automaattisesti.</p>

  </header>

  <h3>.gitignore-tiedoston käyttö</h3>

  <p>
    .gitignore-tiedosto määrittelee, mitkä projektin tiedostot tai
    kansiot Gitin tulee jättää huomioimatta, eli
    <strong>mitä ei sisällytetä versionhallintaan</strong>. Sinne lisätään
    yleensä tiedostoja, joita ei
    tarvita tai haluta repositorioon, kuten käännöstiedostoja, riippuvuuksia,
    paikallisia asetuksia ja tiedostoja, jotka sisältävät salaisuuksia
    (esimerkiksi <code>.env</code>-tiedosto). .gitignore-tiedosto kannattaa
    luoda projektin alkuvaiheessa ja pitää ajan tasalla, jotta arkaluontoiset
    tiedot eivät päädy repositorioon vahingossa.
  </p>

  <p>
    <strong>.gitignore</strong>-tiedosto on tavallinen tekstitiedosto, jossa
    jokainen rivi
    määrittää tiedoston tai kansion, joka halutaan sulkea pois
    versionhallinnasta. Esimerkki yksinkertaisesta
    .gitignore-tiedostosta:
  </p>
  <pre><code>        .env
        node_modules/
        dist/
        build/
        *.log
    </code></pre>
  <p>
    Tämä .gitignore-tiedosto estää Gitin seuraamasta tiedostoa
    <em>.env</em>, kaikkia <em>.log</em>-päätteisiä tiedostoja ja kansioita:
    <em>node_modules/</em>, <em>dist/</em> ja <em>build/</em>.
    Huomioi kuitenkin, että .gitignore vaikuttaa vain tiedostoihin, joita ei ole
    vielä lisätty versionhallintaan.
    Voit luoda .gitignore-tiedoston manuaalisesti tai käyttää valmiita
    malleja, joita
    löytyy moniin eri tilanteisiin esimerkiksi
    <a href="https://github.com/github/gitignore" target="_blank"
      >GitHubin gitignore-mallivarastosta</a>.
  </p>

  <figure>
    <img
      class="wide-image"
      src="../../assets/images/teamwork/gitignore/ignored-file.png"
      alt="Ohitetut tiedostot VS Coden Explorer-näkymässä" />
    <figcaption>Ohitetut tiedostot VS Coden Explorer-näkymässä</figcaption>
  </figure>

  <p>
    Kun .gitignore-tiedosto on käytössä ja tiedosto tai kansio on lisätty
    ohitettavien listaan oikein, näkyy se VS Coden Explorer-näkymässä
    harmaana. Tämä auttaa varmistamaan, että Git ei seuraa
    kyseistä tiedostoa.
  </p>

  <p class="note-box">
    <strong>Huom!</strong> .gitignore ei poista tiedostoja, jotka on jo lisätty
    versionhallintaan. Jos tiedosto näkyy normaalina (ei harmaana), poista se
    Gitin seurannasta komennolla <code>git rm --cached tiedostonimi</code> ja
    tee commit.
  </p>

  <h3>Ympäristömuuttujat (<em>environment variables</em>)</h3>
  <p>
    Ympäristömuuttujat tarjoavat <strong>turvallisen tavan tallentaa
    arkaluontoisia tietoja</strong> erillään koodista. Ne voidaan määrittää
    paikallisesti
    kehitysympäristössä tai palvelimella, jossa sovellus ajetaan. Yleinen
    käytäntö on tallentaa ne <strong>.env</strong>-tiedostoon, joka on suljettu
    pois versionhallinnasta .gitignore-tiedoston avulla.
  </p>

  <div class="note-box">
    Varmista aina, että salaisuudet ovat .env-tiedostossa ja .gitignore
    toimii oikein ennen commitoimista. Tämä ehkäisee vahinkovuodot jo ennen kuin
    ne pääsevät versionhallinnan historiaan asti.
  </div>


  <h5>Jos salaisuudet ehtivät vuotaa</h5>
  <p>
    Jos arkaluontoinen tiedosto tai salaisuus päätyy GitHubiin, pelkkä
    .gitignore tai <code>git rm --cached</code> eivät poista sitä
    aiemmista commit-versioista. Poista tiedosto repositorion nykytilasta ja
    <strong>mitätöi vuodetut salasanat tai API-avaimet heti</strong>.
  </p>

  <p>
    Jos kyseessä on harjoitusprojekti, helpoin ja turvallisin ratkaisu voi olla
    poistaa koko repositorio ja luoda se uudelleen ilman arkaluontoisia
    tiedostoja. Näin varmistat, ettei tieto jää repositorion historiaan.
  </p>

  <p>
    Tuotantoprojekteissa pyydä apua kokeneemmalta kehittäjältä ja
    perehdy GitHubin virallisiin ohjeisiin ennen kuin lähdet muokkaamaan
    repositorion historiaa. Lisätietoja löydät GitHubin dokumentaatiosta
    kohdasta:
    <a
      href="https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/removing-sensitive-data-from-a-repository"
      target="_blank" rel="noopener noreferrer">
      GitHub Docs - Removing sensitive data from a repository</a>.
  </p>

  <h3>Secret Protection</h3>
  <p>
    Vaikka salaisuudet tallennetaan ympäristömuuttujiin ja pidetään
    .gitignore-tiedoston avulla versionhallinnan ulkopuolella, virheitä
    voi silti sattua. <strong>GitHubin Secret Protection</strong> -ominaisuus
    auttaa ehkäisemään vuotoja tunnistamalla automaattisesti esimerkiksi
    API-avaimet ja muut tunnisteet, jos ne päätyvät koodiin, ja ilmoittamalla
    niistä kehittäjälle.
  </p>

  <p>Voit ottaa tämän ominaisuuden käyttöön omassa repositoriossasi kohdasta
    <em>Settings → Advanced Security</em>.
  </p>

  <p class="note-box">
    <strong>Vinkki!</strong> Käytä GitHubin Secret Protection -ominaisuutta
    yhdessä Dependabotin ja CodeQL:n kanssa parantaaksesi projektisi
    turvallisuutta entisestään.
  </p>
</section>