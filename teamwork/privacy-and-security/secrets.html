<section class="secrets">
  <header>
    <h1>Salaisuuksien ja tiedostojen suojaaminen</h1>
  </header>

  <p>
    Kuten edellisessä osiossa mainittiin, GitHub-repositorioon ei saa lisätä arkaluontoisia tietoja.
    Tällaiset tiedot voivat joutua vääriin käsiin ja vaarantaa projektin turvallisuuden. Käytä sen
    sijaan <em>.gitignore</em>-tiedostoa sulkemaan pois tietyt tiedostot versionhallinnasta ja
    hyödynnä ympäristömuuttujia (<em>environment variables</em>) luottamuksellisten tietojen
    tallentamiseen.
  </p>

  <h4>.gitignore-tiedoston käyttö</h4>
  <p>
    <em>.gitignore</em>-tiedosto määrittelee, mitkä tiedostot tai kansiot Gitin tulee jättää
    huomioimatta. Sinne lisätään yleensä tiedostoja, joita ei tarvita tai haluta versionhallintaan,
    kuten käännöstiedostoja, riippuvuuksia ja paikallisia konfiguraatioita. .gitignore-tiedosto
    kirjoitetaan yksinkertaisella tekstimuotoisella kielellä, jossa jokainen rivi määrittää
    tiedoston tai kansion, joka halutaan sulkea pois versionhallinnasta.
  </p>
  <p>Esimerkki yksinkertaisesta <em>.gitignore</em>-tiedostosta:</p>
  <pre>
    <code>
        .env
        node_modules/
        dist/
        build/
        *.log
    </code>
  </pre
  ><br />

  <p>
    Voit luoda <em>.gitignore</em>-tiedoston manuaalisesti tai käyttää valmiita malleja, joita
    löytyy esimerkiksi
    <a href="https://github.com/github/gitignore" target="_blank"
      >GitHubin gitignore-mallivarastosta</a
    >.
  </p>

  <p>
    Kun .gitignore-tiedosto on käytössä ja tiedosto tai kansio on lisätty ohitettavien listaan
    oikein, näkyy se VS Coden Explorer-näkymässä <strong>harmaana</strong>. Tämä auttaa
    varmistamaan, että Git ei seuraa kyseistä tiedostoa. <br /><br />
    Huom: Jos tiedosto näkyy edelleen normaalin värisenä, se on todennäköisesti jo aiemmin lisätty
    Gitin seurantaan. Tällöin se pitää poistaa seurannasta komennolla
    <code>git rm --cached tiedostonimi</code>.
  </p>

  <div class="note-box warning">
    <ul>
      <li class="warning">
        <strong>Huomio:</strong> Jos tiedosto on jo päätynyt GitHub-repositorioosi ennen kuin lisäät
        sen <code>.gitignore</code>-tiedostoon, pelkkä ignore-listaan lisääminen ei riitä. Git ei
        poista aiemmin versioitua tiedostoa automaattisesti, vaan se on poistettava erikseen
        versionhallinnan historiasta ja/tai repositoriosta käsin.
      </li>
      <li>
        Yleensä tämä tehdään poistamalla tiedosto Gitin seurannasta komennolla
        <code>git rm --cached tiedosto</code> ja commitoimalla muutos. Jos tiedosto halutaan poistaa
        myös repositorion historiasta (esim. vahingossa lisättyjen salaisuuksien tapauksessa),
        siihen tarvitaan erillisiä työkaluja, kuten <em>git filter-repo</em> tai GitHubin oma
        <em>Repository history cleanup</em>.
      </li>
      <li>
        Lisätietoja:
        <a
          href="https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/removing-sensitive-data-from-a-repository"
          target="_blank">
          GitHub Docs – Removing sensitive data from a repository
        </a>
      </li>
    </ul>
  </div>

  <figure>
    <img
      class="wide-image"
      src="../../assets/images/teamwork/gitignore/ignored-file.png"
      alt="Ohitetut tiedosto VS Coden Explorer-näkymässä." />
    <figcaption
      >VS Coden Explorer-näkymässä .gitignorella ohitetut tiedostot näkyvät harmaina.</figcaption
    >
  </figure>

  <h4>Ympäristömuuttujat (<em>environment variables</em>)</h4>
  <p>
    Ympäristömuuttujat tarjoavat turvallisen tavan tallentaa arkaluontoisia tietoja erillään
    koodista. Ne voidaan määrittää paikallisesti kehitysympäristössä tai palvelimella, jossa
    sovellus ajetaan. Yleinen käytäntö on tallentaa ne <em>.env</em>-tiedostoon, joka on suljettu
    pois versionhallinnasta <em>.gitignore</em>-tiedoston avulla.
  </p>

  <p>
    Jos lisäät vahingossa arkaluontoisen tiedon, kuten salasanan tai API-avaimen,
    GitHub-repositorioon, poista tiedosto heti ja
    <strong>mitätöi kyseinen avain tai vaihda salasana välittömästi</strong>.
  </p>
  <p>
    Jos kyseessä on harjoitusprojekti, helpoin ja turvallisin ratkaisu on poistaa koko repositorio
    ja luoda se uudelleen ilman arkaluontoisia tiedostoja. Näin varmistat, ettei tieto jää
    historiaan. Jos taas kyseessä on tuotantoprojekti, pyydä apua kokeneemmalta koodarilta ja
    perehdy GitHubin virallisiin
    <a
      href="https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/removing-sensitive-data-from-a-repository"
      target="_blank">
      ohjeisiin datan poistamisesta</a
    >.
  </p>

  <h4>Secret Protection</h4>
  <p>
    GitHubin Secret Protection -ominaisuus havaitsee ja ilmoittaa automaattisesti, jos API-avaimet
    tai muut salaisuudet päätyvät vahingossa koodiin. Kun Secret Protection on käytössä, GitHub
    tarkistaa automaattisesti koodisi ja ilmoittaa, jos se havaitsee mahdollisia salaisuuksia. Voit
    myös määrittää säännöt, jotka estävät tiettyjen tiedostotyyppien tai merkkijonojen lisäämisen
    repositorioon. Voit ottaa tämän ominaisuuden käyttöön omassa repositoriossasi kohdasta
    <em>Settings → Advanced Security</em>.
  </p>

  <p class="note-box">
    <strong>Vinkki:</strong> Käytä GitHubin Secret Protection -ominaisuutta yhdessä Dependabotin ja
    CodeQL:n kanssa parantaaksesi projektisi turvallisuutta entisestään.
  </p>
</section>
