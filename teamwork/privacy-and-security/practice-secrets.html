<section class="training">
  <header>
    <h1>Salaisuudet ja historia</h1>
    <p>
      Tässä harjoituksessa näet, miksi salaisuuksia ei pidä tallentaa
      Git-repositorioon. Harjoitus
      tehdään vain <em>tekaistulla salaisuudella</em> testirepossa.
    </p>

    <h5>Harjoitus 6 - Salaisuuksien käsittely Gitissä</h5>
    <ol>
      <li>Luo tyhjä testirepositorio tai avaa olemassa oleva testiprojekti</li>

      <li>
        Luo tiedosto <em>secrets.txt</em> ja lisää teksti
        <em>API_KEY=DEMO-12345-ABC</em>
      </li>

      <li>
        Tallenna tiedosto versionhallintaan<br />
        <code>git add secrets.txt <br /> </code>
      </li>

      <li>
        Commitoi tiedosto<br />
        <code>git commit -m "Lisää demoavain testitarkoituksiin"</code>
      </li>

      <li>
        Puske muutokset GitHubiin<br />
        <code>git push -u origin main</code>
      </li>

      <li>Tarkista, että tiedosto näkyy repositorion etusivulla</li>

      <li>
        Poista tiedosto manuaalisesti tai komennolla<br />
        <code>git rm secrets.txt </code><br />
      </li>

      <li>
        Kirjaa poisto omaksi commitiksi<br />
        <code>git commit -m "Poista demoavain"</code>
      </li>

      <li>
        Puske muutokset GitHubiin<br />
        <code>git push -u origin main</code>
      </li>

      <li>Tarkista, että tiedostoa ei näy repositorion etusivulla</li>

      <li>
        Etsi tiedosto GitHubin historiasta: etsi selaimella
        <em>Commits-lista</em> → siirry ensimmäiseen
        commit-merkintään → paina <em>Load Diff</em> ja tarkastele diffiä
      </li>

      <li>
        Tarkista myös paikallisesti tiedoston historia ja sen sisältö<br />
        <code>git log --follow -- secrets.txt</code><br />
        <code>git show HEAD~1:secrets.txt</code><br />
      </li>
      <div class="note-box margin-right">
        <ul>
          <li class="warning">Poistettu sisältö on yhä nähtävissä historiassa!
          </li>
        </ul>
      </div>

      <li>
        Lisää suojaukseksi mallipohja ja ignore-sääntö<br />
        <em>.env.example</em> sisältö<br />
        <code>API_KEY=your_api_key_here</code><br />
        <em>.gitignore</em> sisältö<br />
        <code>.env</code><br />
        <code>.env.*</code>
        <p>Oikeat arvot sijoitetaan omaan <em>.env</em>-tiedostoon, jota ei
          koskaan commitata!</p>
      </li>

      <li>
        <strong>Lisätehtävä:</strong> kokeile historian muuttamista vain tässä
        testirepossa ja ymmärrä vaikutukset<br />
        <code>git filter-branch --force --index-filter \</code><br />
        <code>'git rm --cached --ignore-unmatch secrets.txt' \</code><br />
        <code>--prune-empty --tag-name-filter cat -- --all</code><br />
        <p>
          Tämä komento käy läpi koko commit-historian ja poistaa
          <code>secrets.txt</code>-tiedoston jokaisesta versiosta.
          <code>--force</code> sallii historian muokkaamisen,
          <code>--index-filter</code> määrittää, mitä poistetaan,
          ja <code>--prune-empty</code> siivoaa pois tyhjiksi jääneet commitit.
        </p>
        <p>
          Voit tehdä saman uudemmalla työkalulla, kuten
          <code>git filter-repo</code> (vaatii erillisen asennuksen,
          <a href="https://github.com/newren/git-filter-repo" target="_blank" rel="noopener noreferrer">
    asennusohjeet GitHubissa</a>)
        </p>
      </li>
      <div class="note-box">
        <ul>
          <li class="warning"><strong>Huom!</strong> Historian muokkaaminen on
            riskialtista. Se muuttaa aiemmat commitit ja voi rikkoa paikallisia
            kopioita tai aiheuttaa virheitä GitHubissa. Oikeissa projekteissa
            toimi aina organisaation ohjeiden mukaisesti.
          </li>
        </ul>
      </div>

    </ol>

    <p>
      Onnittelut! Nyt tiedät, miksi salaisuudet pidetään aina Gitin ulkopuolella
      ja miksi
      <code>.gitignore</code>
      sekä
      <code>.env</code>-mallit ovat hyödyllisiä.
    </p>

    <p class="note-box">
      <strong>Mieti tarkkaan mitä julkaiset!</strong> Etärepositorioon ei saa
      puskea mitään salaista: ei API-avaimia, salasanoja eikä muuta
      arkaluonteista tietoa.
    </p>


  </header>
</section>