<section class="introduction">
  <header>
    <h1>CI/CD-automaatio</h1>

    <p>CI/CD kirjainyhdistelmä tulee sanoista
      <strong>Continuous Integration</strong> ja
      <strong>Continuous Deployment</strong> (tai Continuous Delivery). CI/CD
      tarkoittaa menetelmiä ja työkaluja, joilla automatisoidaan
      ohjelmistokehityksen vaiheet, kuten testaus, laadunvarmistus, mahdollinen
      käännösvaihe sekä tuotantoon vienti.
    </p>

    <ul>
      <li>
        <strong>Jatkuva integraatio (CI):</strong> automatisoi testaamisen ja
        laadunvarmistuksen, tarvittaessa lähdekoodin käännökset
        (<em>build</em>), sekä koodiin tehtyjen muutosten yhdistämisen
        päähaaraan
      </li>

      <li>
        <strong>Jatkuvat toimitus- ja käyttöönottomallit (CD):</strong>
        CI/CD:ssä CD voi tarkoittaa kahta eri automaatiomallia, joista yleensä
        on käytössä vain toinen
        <ul>
          <li>
            <strong>Jatkuva toimitus (Continuous Delivery):</strong>
            tuottaa
            tuotantovalmiin version, mutta automaatio pysähtyy ennen julkaisua
            odottamaan ihmisen hyväksyntää
          </li>

          <li>
            <strong>Jatkuva käyttöönotto (Continuous Deployment):</strong>
            tuottaa tuotantovalmiin version ja vie muutokset automaattisesti
            tuotantoympäristöön
          </li>
        </ul>
      </li>
    </ul>

    <p>
      Yhdessä ne muodostavat <strong>CI/CD-putken</strong>, eli sarjan
      automatisoituja työnkulkuja, jotka auttavat vähentämään sovellusten
      julkaisuun liittyviä manuaalisesti suoritettavia tehtäviä.
    </p>

  </header>
  <main>
    <h3>Mitä hyötyä CI/CD-menetelmistä on?</h3>

    <p>
      Suurin CI/CD-menetelmistä saatava hyöty on
      <strong>julkaisunopeus</strong>: kehitystiimit voivat julkaista muutoksia
      useammin ja nopeammin. Julkaisnuopeuden lisäksi menetelmällä on myös muita
      hyötyjä, kuten sovelluksen <strong>kehityksen tehostuminen</strong>
      (muutokset voidaan tehdä pienempinä ja hallittavampina kokonaisuuksina),
      koodin <strong>luotettavuuden</strong> ja <strong>vakauden kasvu</strong>
      (testiautomaation ansiosta sovellus pysyy varmemmin julkaisukunnossa),
      sekä <strong>tuottavuuden lisääntyminen</strong> (automaatio vapauttaa
      aikaa muihin tehtäviin).
    </p>

    <h3>Esimerkki CI/CD-putkesta (continuous deployment)</h3>
    <p>
      CI/CD-putki (<em>pipeline</em>) voi määrittää esimerkiksi, mitä tapahtuu,
      kun projektiin tehdään muutos ja se yhdistetään päähaaraan. Tavoitteena on
      varmistaa, että uusi versio rakennetaan ja julkaistaan luotettavasti,
      samaa prosessia noudattaen ja ilman manuaalisia toimenpiteitä. Seuraavassa
      esimerkissä on esitettynä pääpiirteittäin yksinkertainen työnkulku, joka
      voisi automatisoida esim. verkkosivuston tai web-sovelluksen muutosten
      julkaisemisen.
    </p>

    <h5>Esimerkkiprosessi: Verkkosivun CI/CD-vaiheet</h5>
    <figure>
      <img
        class="wide-image"
        src="../../assets/images/advanced/cicd/CICD-kaavio.webp"
        alt="Kaaviokuva CI/CD-työnkulun vaiheista" />
      <figcaption>
        Kaaviossa kuvataan CI/CD-prosessin etenemistä kehittäjän tekemästä
        muutoksesta aina
        tuotantoon saakka
      </figcaption>
    </figure>
    <ol>
      <li>
        <h6>Muutosten tekeminen ja versiohallinta</h6>
        <ul>
          <li>Tehdään koodimuutos, kuten uusi toiminnallisuus, ja pusketaan se
            GitHub-repositorioon.</li>
          <li>Yhdistetään muutoksen kehityshaara päähaaraan (<em>main</em>) pull
            requestin kautta.</li>
          <li>Pull requestin <em>merge</em> käynnistää automaattisesti
            CI/CD-prosessin.
          </li>
        </ul>
      </li>
      <li>
        <h6>Continuous Integration (CI)</h6>
        <p>Seuraavaksi käynnistyy CI-vaihe, jossa koodi tarkistetaan ja
          testataan
          automaattisesti. CI-prosessille tyypillisiä alavaiheita ovat:</p>
        <ol>
          <li><strong>Checkout:</strong> Haetaan projektin koodi CI-työnkulun
            käyttöön.</li>
          <li>
            <strong>Asennukset:</strong> Asennetaan projektin tarvitsemat
            paketit
            (esim. <em>npm install</em>).
          </li>
          <li>
            <strong>Testaus ja laadunvarmistus:</strong> Tehdään koodin
            laaduntarkastus (esim.
            ESLint) ajetaan automaattiset testit (yksikkötestit,
            komponenttitestit ja
            end-to-end-testit yms.).
          </li>
          <li>
            <strong>Käännös (Build):</strong> Tarvittaessa käännetään tai
            generoidaan sivustosta tuotantoon valmis versio.
          </li>
        </ol>
      </li>
      <li>
        <h6>Continuous Deployment (CD)</h6>
        <p>Kun CI-vaihe on suorittanut testit ja buildin onnistuneesti, CD
          huolehtii sovelluksen julkaisemisesta. Täysin automatisoidussa
          <strong>continuous deployment</strong> -mallissa muutokset viedään
          automaattisesti tuotantoon ilman erillistä hyväksyntää.
        </p>
        <ol>
          <li>
            <strong>Muutosten vieminen palvelimelle:</strong> Tehdään
            tarvittavat muutokset
            palvelimella oleviin HTML/CSS/JS tiedostojen julkaisuversioihin.
            Tämä voi tarkoittaa
            useita eri vaiheita, kuten sovelluksen eri osien vanhojen
            tiedostojen poistoa ja uusien
            kopioimista tilalle esim. Secure Shellin (SSH) avulla.
          </li>
          <li>
            <strong>Sovelluksen käynnistäminen:</strong> Web-sovellus voi vaatia
            uudelleen käynnistämisen muutosten jälkeen. Tämä varmistaa, että
            sovellus toimii oikein uusilla muutoksilla. Uudelleen käynnistys
            voidaan toteuttaa automaattisesti SSH avulla palvelimella
            suoritettavien skriptien tai prosessinhallinta-työkalujen (esim.
            PM2) avulla.
          </li>
          <li>
            <strong>Käyttöönoton validointi:</strong> Tarkistetaan, että sivusto
            latautuu ja vastaa oikein.
          </li>
          <li><strong>Versionumerointi:</strong> Sovelluksen versionumero
            voidaan päivittää
            prosessissa automaattisesti (esim. v1.0.3 → v1.0.4).</li>
          <li>
            <strong>Ilmoitukset:</strong> Automaattisesti lähetettävällä
            “Deployment successful ✅”-viestillä kehitystiimille voidaan
            ilmoittaa uudesta versiosta tuotannossa. Ilmoitukset voidaan
            lähettää esim. sähköpostin, Slackin, Discordin tms. viestintäkanavan
            kautta.
          </li>
        </ol>
      </li>
      <li>
        <h6>Muita mahdollisia vaiheita:</h6>
        <ul>
          <li>
            <strong>Tulosten raportointi:</strong> Erityisesti jos jokin
            vaiheista epäonnistuu ja
            työnkulku keskeytyy, kehittäjälle ilmoitetaan virheestä, jotta
            ongelmiin voidaan
            reagoida.
          </li>
          <li>
            <strong>Rollback:</strong> Jos jokin julkaisuun (CD) liittyvistä
            vaiheista epäonnistuu
            ja työnkulku keskeytyy, voi syntyä tarve palata edelliseen toimivaan
            versioon, eli tehdä rollback.
          </li>
        </ul>
      </li>
    </ol>
    <div class="note-box">
      Tämä esimerkki kuvaa yhden yksinkertaistetun tavan toteuttaa
      CI/CD-prosessi. Käytännössä työnkulut vaihtelevat paljon projektin
      teknologioiden, ympäristön ja tiimin tarpeiden mukaan. Tärkeintä on, että
      prosessi palvelee projektin tavoitteita ja mahdollistaa luotettavan,
      turvallisen, toistettavan ja järkevästi automatisoidun julkaisun.
    </div>

    <strong>Lähde:</strong>
    <em
      ><a
        target="_blank"
        rel="noopener noreferrer"
        href="https://github.com/resources/articles/ci-cd"
        >What is CI/CD?</a
      ></em>
  </main>
</section>