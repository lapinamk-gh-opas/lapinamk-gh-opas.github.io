<section class="github-projects">
  <header>
    <h1>GitHub Actions</h1>
    <p>
      GitHub Actions on GitHubiin
      <strong>sisäänrakennettu CI/CD-alusta</strong>, jonka avulla voidaan
      automatisoida ohjelmiston käännös-, testaus- ja käyttöönottoprosesseja.
      GitHub Actions ei suorita kaikkia tehtäviä itse, vaan ajaa määriteltyjä
      työnkulkuja (<em>workflows</em>) virtuaalikoneella (<em>runner</em>).
      Työnkulut määritellään YAML-tiedostoissa, joissa kuvataan, mitä työkaluja
      ja komentoja automaation tulee suorittaa.
    </p>
    <p>
      Työnkulku käynnistyy aina, kun ennalta määritelty tapahtuma toteutuu
      repositoriossa, kuten koodin
      <em>push</em>, <em>pull
      request</em> tai <em>uuden issuen luonti</em>.
      GitHub
      Actionsin avulla voidaan automatisoida monia toistuvia kehitys- ja
      ylläpitotehtäviä, myös sellaisia, jotka eivät suoraan liity CI/CD-putkeen,
      kuten esimerkiksi dokumentaation automaattiset päivitykset.
    </p>
  </header>
  <main>

    <h3>Miksi GitHub Actions</h3>
    <p>
      GitHub Actions tarjoaa helpon tavan automatisoida toistuvat työvaiheet
      ilman erillisiä CI/CD-työkaluja. Se vähentää manuaalista työtä, nopeuttaa
      kehitysprosessia ja parantaa työn toistettavuutta. Työnkulut voidaan
      rakentaa hyvin kevyiksi yksittäisistä testiajoista aina monivaiheisiin
      julkaisuprosesseihin, joten ratkaisu skaalautuu sekä pieniin
      opiskelijaprojekteihin että laajoihin yrityssovelluksiin.
    </p>

    <h3>Keskeiset ominaisuudet</h3>
    <table>
      <thead>
        <tr>
          <th>Ominaisuus</th>
          <th>Kuvaus</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>CI/CD-alusta</td>
          <td>Automatisoi sovelluksen käännökset, testit ja julkaisut</td>
        </tr>
        <tr>
          <td>Tapahtumapohjainen</td>
          <td>Workflowt käynnistyvät esim. pushista, pull requestista,
            aikataulusta tai manuaalisesti</td>
        </tr>
        <tr>
          <td>Rinnakkaiset ja ketjutetut jobit</td>
          <td>Nopeammat ajot ja tarkka kontrolli suoritusjärjestyksestä</td>
        </tr>
        <tr>
          <td>Salaisuuksien hallinta (Secrets)</td>
          <td>Turvallinen tapa
            tallentaa API-avaimia,
            tunnuksia ja muita arkaluontoisia muuttujia</td>
        </tr>
        <tr>
          <td>Useat ympäristöt</td>
          <td>Linux, Windows ja macOS -runnerit, sekä mahdollisuus ajaa sama
            workflow
            eri versioilla</td>
        </tr>
        <tr>
          <td>Self-hosted runnerit</td>
          <td>Workflowt voidaan ajaa myös omalla laitteella tai palvelimessa
          </td>
        </tr>
        <tr>
          <td>Marketplace-toiminnot</td>
          <td>Valmiita actioneita, joiden avulla
            workflowt on helpompi toteuttaa</td>
        </tr>
        <tr>
          <td>Käyttörajoitukset</td>
          <td>Ilmaisella tilillä 2000 minuuttia/kk ja 500 MB tallennustilaa
            artifakteille ja paketeille</td>
        </tr>
      </tbody>
    </table>

    <h3>GitHub Actions - Keskeiset käsitteet ja komponentit</h3>

    <h5>Työnkulut (Workflows)</h5>

    <p>
      GitHub Actions -työnkulku määritellään YAML-tiedostossa, joka sijaitsee
      repositorion juurihakemistossa polussa
      <code>.github/workflows/</code>. Jokainen työnkulku tallennetaan omaan
      tiedostoonsa, esimerkiksi <code>.github/workflows/deploy.yaml</code>.
      Työnkulku sisältää kuvauksen siitä, mitä automaattisia tehtäviä GitHubin
      pitää suorittaa ja missä tilanteissa ne käynnistyvät.
    </p>

    <figure>
      <img
        class="wide-image"
        src="../../assets/images/advanced/cicd/workflow.png"
        alt="GitHub Actions -työkulun määrittävän .yaml-tiedoston aloitus" />
      <figcaption>
        GitHub Actions -työkulun määrittävän .yaml-tiedosto aloitus
      </figcaption>
    </figure>

    <p>
      Työnkulku koostuu yhdestä tai useammasta tehtävästä (jobs), jotka voivat
      sisältää useita vaiheita. Se voidaan käynnistää automaattisesti
      tapahtuman perusteella, manuaalisesti tai ennalta määritellyn aikataulun
      mukaan.
    </p>

    <div
      class="accordion"
      data-include="../../accordion-element/accordion.html"
      data-title="YAML merkintäkieli ja sisennyskäytäntö">
      <div class="contentToAccordion">
        <p>
          <strong>YAML</strong> (YAML Ain't Markup Language) on rakenteinen
          tiedostomuoto, jossa sisennys kertoo tiedon hierarkian (kuten koodissa
          lohkot ilmaistaan sisennyksillä). GitHub Actionsin workflow-tiedostot
          (.yml tai .yaml) perustuvat YAML-syntaksiin, joten sisennyksen
          merkitys niissä on erittäin tärkeä. Sisennystaso kertoo, mihin
          avaimeen rivi kuuluu. Jos rivi on väärässä kohdassa, työnkulku ei
          välttämättä toimi lainkaan.
        </p>
        <h6>Perusperiaatteet:</h6>
        <ul>
          <li>YAML käyttää rakenteen määrittelyyn sisennystä</li>
          <li>Sisennys tehdään aina välilyönneillä, ei sarkaimella (Tab)</li>
          <li>
            Yleinen käytäntö GitHub Actions -tiedostoissa on käyttää kahta
            välilyöntiä
            per sisennystaso
          </li>
          <li>Lisätietoa YAML-syntaksista löydät
            <a
              target="_blank"
              rel="noopener noreferrer"
              href="https://docs.ansible.com/projects/ansible/latest/reference_appendices/YAMLSyntax.html"
              >täältä</a>.
          </li>
        </ul>
        <figure>
          <img
            class="wide-image"
            src="../../assets/images/advanced/cicd/yaml.png"
            alt="Esimerkki sisennystasojen käytöstä YAML-merkintäkielessä" />
          <figcaption> Esimerkki sisennystasojen käytöstä YAML-merkintäkielessä
          </figcaption>
        </figure>
      </div>
    </div>

    <h5>Tapahtumat (Events)</h5>
    <p>
      Tapahtuma (event) määrittelee sen, mikä saa työnkulun käynnistymään.
      Tyypillisiä tapahtumia ovat esimerkiksi <code>push</code>,
      <code>pull_request</code>, <code>issues</code> ja <code>schedule</code>.
      Tapahtuma asetetaan työnkulun YAML-tiedostossa, ja sen perusteella GitHub
      tietää milloin työnkulku suoritetaan.
    </p>
    <figure>
      <img
        class="wide-image"
        src="../../assets/images/advanced/cicd/events.png"
        alt="Työkulun laukaisevan tapahtuman määrittäminen .yaml-tiedostossa" />
      <figcaption>
        Työkulun laukaisevan tapahtuman (events) määrittäminen .yaml-tiedostossa
      </figcaption>
    </figure>


    <h5>Tehtävät (Jobs)</h5>
    <p>
      Tehtävä (job) on työnkulun osa, joka suoritetaan omassa erillisessä
      runner-ympäristössään. Runneri määritellään tehtävän alussa, esimerkiksi
      <code>ubuntu-latest</code>. Jokainen tehtävä koostuu useista askelista
      (steps), jotka suoritetaan määritetyssä järjestyksessä.
    </p>
    <figure>
      <img
        class="wide-image"
        src="../../assets/images/advanced/cicd/jobs.png"
        alt="Tehtävän ja runnerin määrittäminen .yaml-tiedostossa" />
      <figcaption>
        Työnkulussa suoritettavan tehtävän (jobs) ja runnerin (ubuntu-latest)
        määrittäminen
        .yaml-tiedostossa
      </figcaption>
    </figure>

    <div class="note-box">
      <h6 class="no-margin-top">Suoritusympäristö (runner)</h6>
      <ul class="no-margin-bottom">
        <li>Runner on virtuaalikone, joka suorittaa työnkulun tehtävät</li>
        <li>GitHub tarjoaa valmiit Linux, Windows ja macOS -virtuaaliympäristöt
        </li>
        <li>Jokainen työnkulku ajetaan uudessa ja alustetussa (puhtaassa)
          virtuaalikoneessa</li>
      </ul>
    </div>

    <h5>Askeleet (Steps)</h5>

    <p>
      Askeleet (steps) muodostavat tehtävän sisäisen toiminnallisuuden.
      Jokainen askel suoritetaan siinä järjestyksessä, jossa se on määritelty.
      Askeliin voi sisältyä valmiita toimintoja eli actionseja, kuten
      <code>actions/checkout@v4</code>.
    </p>
    </p>
    <figure>
      <img
        class="wide-image"
        src="../../assets/images/advanced/cicd/steps.png"
        alt="Askeleiden ja valmiin actionin määrittäminen .yaml-tiedostossa" />
      <figcaption>
        Askeleiden (steps) ja valmiin actionin (actions/checkout@v4)
        määrittäminen .yaml-tiedostossa
      </figcaption>
    </figure>
    <p>
      Askeliin voi sisältyä myös komentorivikomentoja eli skriptejä, jotka
      suoritetaan suoraan runner-ympäristössä. Näitä käytetään esimerkiksi
      asentamiseen, testaamiseen tai projektin rakentamiseen.
    </p>
    <figure>
      <img
        class="wide-image"
        src="../../assets/images/advanced/cicd/scripts.png"
        alt="Skripteillä määritettyjä askeleita .yaml-tiedostossa" />
      <figcaption>
        Skripteillä määritettyjä askeleita .yaml-tiedostossa
      </figcaption>
    </figure>
    <p>
      Askeleiden avulla määritetään yksityiskohtaisesti, mitä tehtävän aikana
      tapahtuu. Tehtävät voivat olla toisistaan riippuvaisia ja ne voidaan ajaa
      tietyssä järjestyksessä tai rinnakkain työnkulun tarpeiden mukaan.
    </p>

    <div class="note-box">
      <h6 class="no-margin-top">Toiminnot (Actions)</h6>
      <p>Action on uudelleenkäytettävä tehtävä, joka suorittaa tietyn toiminnon
        työnkulun aikana. Se voi olla valmis toiminto GitHub
        <a target="_blank" rel="noopener noreferrer" href="https://github.com/marketplace">
            Marketplace </a>-kirjastosta tai kehittäjän itse tekemä ratkaisu.
      </p>
      <ul>
        <li>
          Esimerkkejä:
          <ul>
            <li>Koodin checkout GitHubista (actions/checkout), hakee lähdekoodi
              runnerin käyttöön
            </li>
            <li>Julkaisun (release) tekeminen GitHubiin
              (actions/create-release@v1)</li>
          </ul>
        </li>
      </ul>
    </div>

    <div
      class="accordion"
      data-include="../../accordion-element/accordion.html"
      data-title="GitHub Actions vielä pähkinänkuoressa">
      <div class="contentToAccordion">
        GitHub Actions -työnkulku rakentuu neljästä peruselementistä: event,
        jobs,
        runner ja steps.
        </p>

        <h6>Esimerkki työnkulun rakenteesta</h6>
        <pre><code>on: 
  push                                # Event - mikä käynnistää workflow'n

jobs:                                 # Jobs - mitä workflow tekee
  build:                              # - tässä vain yksi job 'build'
    runs-on: ubuntu-latest            # Runner - missä jobi ajetaan

    steps:                            # Steps - mitä komentoja suoritetaan
      - uses: actions/checkout@v4     # Step 1 - ensin ajetaan valmis action
      - run: npm install              # Step 2 - sitten komentorivikomento
</code></pre><br>

        <p>Tämä työnkulku käynnistyy aina <code>push</code>-tapahtumasta. Se
          ajaa
          <code>build</code>-nimisen tehtävän <code>ubuntu-latest</code>
          -ympäristössä,
          hakee projektin koodin käyttöön ja asentaa riippuvuudet komennolla
          <code>npm install</code>.
        </p>


        <strong>Lähde:</strong>
        <em
      ><a target="_blank" rel="noopener noreferrer" href="https://docs.github.com/en/actions"
        >GitHub Actions documentation</a
      ></em>
  </main>
</section>